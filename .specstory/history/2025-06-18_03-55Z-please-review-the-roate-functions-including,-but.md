<!-- Generated by SpecStory -->

# Please review the roate functions - including, but (2025-06-18 03:55Z)

_**User**_

Please review the roate functions - including, but not limited to rotateWrapper, rotateWrapped rotateCanvas, rotateCanvasOrig and rotateInner. rotateWrapped . rotateWrapped is not currently called,  but should not be removed for that reason. Please consolidate functions that do not need to be separate, unless they are called separately, or if separation makes the code easier to understand. Please ask any questions needed.

---

_**Assistant**_

I'll analyze the rotation functions in the sketch.js file to understand their relationships and consolidate where appropriate.

## Analysis of Rotation Functions

Looking at the rotation functions, I can see there are several related functions that handle canvas rotation:

1. **`rotateWrapper`** - Returns a function that calls `rotateCanvas` with specific parameters
2. **`rotateCanvas`** - Main rotation implementation (newer version)
3. **`rotateCanvasOrig`** - Wrapper that calls `rotateInner` 
4. **`rotateInner`** - Original rotation implementation
5. **`rotateWrapped`** - Property that stores the result of `rotateWrapper(pct)`

## Questions for Clarification

Before consolidating, I have a few questions:

1. **Version preference**: The code has both `rotateCanvas` (newer) and `rotateInner` (original) implementations. Which version should be kept as the primary implementation?

2. **Parameter handling**: The newer `rotateCanvas` takes explicit parameters `{ direction, height, width, layers, p5 }`, while the original uses `params` object. Should we standardize on one approach?

3. **Function exposure**: Currently `pct.rotateCanvas` points to `rotateCanvasOrig` (which uses the old implementation), but `pct.rotateWrapped` points to the newer version. Which should be the primary exposed function?

4. **Recording behavior**: Both implementations call `recordAction` - should this be consistent?

Based on my analysis, here's what I propose to consolidate:

## Proposed Consolidation

### [sketch.js](file:///Users/michaelpaulukonis/projects/polychrome.p5/src/sketch.js)

Consolidate the rotation functions by removing redundant implementations and keeping the cleaner, more explicit version.

````javascript
// ...existing code...

  const rotateCanvas = ({ direction = 1, height, width, layers, p5 }) => {
    recordAction({ action: 'rotateCanvas', direction, height, width }, pct.appMode !== APP_MODES.STANDARD_DRAW)

    const newHeight = height || pct.params.height
    const newWidth = width || pct.params.width

    // Update params to reflect new dimensions
    pct.params.height = newWidth
    pct.params.width = newHeight

    layers.drawingLayer.resetMatrix()
    layers.drawingLayer.image(layers.p5, 0, 0)

    p5.resizeCanvas(newWidth, newHeight)

    const newPG = initDrawingLayer(newWidth, newHeight)
    newPG.push()
    if (direction === -1) {
      newPG.translate(0, newHeight)
    } else {
      newPG.translate(newWidth, 0)
    }
    newPG.rotate(p5.radians(90 * direction))
    newPG.image(layers.drawingLayer, 0, 0)
    newPG.pop()

    layers.drawingLayer.remove()
    layers.drawingLayer = newPG

    // TODO: undo doesn't know anything about rotation......
    renderLayers({ layers })
    globals.updatedCanvas = true
  }

  const rotateWrapper = (direction = 1) => {
    return rotateCanvas({ 
      direction, 
      height: pct.params.height, 
      width: pct.params.width, 
      layers: pct.layers, 
      p5: pct.p5 
    })
  }

// ...existing code...

  // Remove rotateCanvasOrig and rotateInner functions

// ...existing code...

  // Update exposed functions
  pct.rotateCanvas = rotateWrapper
  pct.rotateWrapped = rotateWrapper

// ...existing code...
````

**Questions before proceeding:**
1. Should I keep both `rotateCanvas` (with explicit params) and `rotateWrapper` (simplified interface), or consolidate to just one?
2. Do you want to maintain backward compatibility with the original parameter structure?
3. Should the params update (`pct.params.height = newWidth`) be kept or handled differently?

Please let me know your preferences and I'll provide the final consolidated implementation.

---

_**User**_

1. keep both
2. no
3. keep the update, but it might be good to comment it. it looks confusing. or refactor for clarity.

---

_**Assistant**_

I'll consolidate the rotation functions while keeping both interfaces and clarifying the parameter updates.

## Step-by-step Solution

1. **Remove redundant functions**: Delete `rotateCanvasOrig` and `rotateInner` 
2. **Keep both interfaces**: Maintain `rotateCanvas` (explicit params) and `rotateWrapper` (simplified)
3. **Clarify parameter updates**: Add clear comments about dimension swapping
4. **Fix exposed function assignments**: Ensure consistent API exposure

### [sketch.js](file:///Users/michaelpaulukonis/projects/polychrome.p5/src/sketch.js)

Remove redundant rotation functions and clarify the parameter handling with better comments.

````javascript
// ...existing code...

  const rotateCanvas = ({ direction = 1, height, width, layers, p5 }) => {
    recordAction({ action: 'rotateCanvas', direction, height, width }, pct.appMode !== APP_MODES.STANDARD_DRAW)

    const newHeight = height || pct.params.height
    const newWidth = width || pct.params.width

    // Swap canvas dimensions after 90-degree rotation
    // When rotating, width becomes height and height becomes width
    pct.params.height = newWidth
    pct.params.width = newHeight

    layers.drawingLayer.resetMatrix()
    layers.drawingLayer.image(layers.p5, 0, 0)

    p5.resizeCanvas(newWidth, newHeight)

    const newPG = initDrawingLayer(newWidth, newHeight)
    newPG.push()
    if (direction === -1) {
      newPG.translate(0, newHeight)
    } else {
      newPG.translate(newWidth, 0)
    }
    newPG.rotate(p5.radians(90 * direction))
    newPG.image(layers.drawingLayer, 0, 0)
    newPG.pop()

    layers.drawingLayer.remove()
    layers.drawingLayer = newPG

    // TODO: undo doesn't know anything about rotation......
    renderLayers({ layers })
    globals.updatedCanvas = true
  }

  const rotateWrapper = (direction = 1) => {
    return rotateCanvas({ 
      direction, 
      height: pct.params.height, 
      width: pct.params.width, 
      layers: pct.layers, 
      p5: pct.p5 
    })
  }

// ...existing code...

  // Remove rotateCanvasOrig, rotateInner, and rotateWrapper(pct) functions

// ...existing code...

  // this smells, but is a start of separation
  pct.adjustGamma = adjustGamma
  pct.apx = apx
  pct.clearCanvas = clearCanvas
  pct.drawCircle = drawCircle
  pct.drawGrid = drawGrid
  pct.drawRowCol = drawRowCol
  pct.flip = flip
  pct.flipCore = flipCore
  pct.guiControl = guiControl
  pct.layers = layers
  pct.mirror = mirror
  pct.newCorner = newCorner
  pct.nextDrawMode = nextDrawMode
  pct.nextRotation = nextRotation
  pct.p5 = p5
  pct.paint = paint
  pct.params = params
  pct.pushpop = pushpop
  pct.randomLayer = randomLayer
  pct.renderLayers = renderLayers
  pct.reset = reset
  pct.rotateCanvas = rotateWrapper
  pct.rotateWrapped = rotateWrapper
  pct.setFont = setFont
  pct.shift = shift
  pct.target = target
  pct.textManager = textManager
  pct.mouseInCanvas = mouseInCanvas
  pct.HORIZONTAL = HORIZONTAL
  pct.VERTICAL = VERTICAL
  pct.draw = standardDraw
  pct.APP_MODES = APP_MODES
  pct.output = output
  pct.clearRecording = clearRecording
  pct.recordAction = recordAction
  pct.recordConfig = recordConfig
  pct.globals = globals
  pct.skewCollection = []
  pct.savit = savit

  return pct
}
````

This consolidation:
- **Removes** `rotateCanvasOrig`, `rotateInner`, and the complex `rotateWrapper(pct)` function
- **Keeps** both `rotateCanvas` (explicit parameters) and `rotateWrapper` (simplified interface)
- **Clarifies** the dimension swapping with clear comments explaining why width/height are swapped
- **Standardizes** the exposed API so both `pct.rotateCanvas` and `pct.rotateWrapped` use the same simplified interface

---

