<!-- Generated by SpecStory -->

# Overview of src/sketch.js for painting app (2025-06-16 16:55:40)

_**User**_

Please do a high-level of src/sketch.js. It's an app using p5js to create a canvas-based painting app that uses text as the brush. I'm sure there is a lot of changes and fixes to be made, but right now I am interested in documenting an overview. Please format the overview in markdown, similar to master.md or other project documentation.

Think carefully, and ask any questions you may have.

---

_**Assistant**_

Looking at `sketch.js`, I can see this is a comprehensive p5.js-based creative coding application. Let me provide a high-level overview in markdown format similar to your project documentation.

# Sketch.js - Core Application Overview

## Purpose
The main sketch file implements a multi-layered text painting application using p5.js. It transforms text into visual art through various drawing modes, color schemes, and interactive controls.

## Architecture Overview

### Core Components
- **Layer Management**: Multi-canvas system with drawing layer, main canvas, and temporary layers
- **Drawing Modes**: Three primary modes - Grid, Circle, and RowCol text layouts
- **Color Systems**: HSB color mode with multiple paint algorithms (rainbow, lerp, solid, etc.)
- **Text Management**: Handles font loading, text rendering, and character/word generation
- **Undo System**: History management for canvas states

### Key Modules Integration
```javascript
// Core dependencies
import UndoLayers from './undo.layers.js'
import Layers from './layers.js'
import { setupGui } from '@/src/gui/gui'
import { setupActions } from '@/src/gui/actions'
```

## Application Modes

### Drawing Modes
1. **STANDARD_DRAW**: Normal interactive painting mode
2. **NO_DRAW**: Paused state, no drawing operations
3. **PLAYBACK**: Script replay mode for automation
4. **TARGET**: Canvas point selection mode (incomplete feature)

### Paint Modes
- **Grid**: Text arranged in grid patterns with configurable spacing
- **Circle**: Text arranged along circular/arc paths
- **RowCol**: Simple row/column text layout

## Core Functionality

### Canvas Management
- **Multi-layer system**: Main display canvas + drawing layer + temporary layer
- **Dynamic resizing**: Canvas dimensions adjustable at runtime
- **Pixel density**: Retina/high-DPI display support

### Text Rendering
- **Font loading**: TTF fonts loaded from assets
- **Text sizing**: Automatic fitting algorithms for different contexts
- **Character modes**: Sequential, random, or word-based text generation

### Color Systems
Multiple paint modes available:
- `rainbow1-4`: HSB-based positional coloring
- `lerp-quad/scheme`: Multi-color interpolation
- `gray1-2`: Grayscale gradients
- `solid`: Single color fills

### Interactive Features
- **Mouse painting**: Click and drag to paint text
- **Keyboard shortcuts**: Extensive hotkey system
- **Auto-paint mode**: Automated random painting
- **Macro system**: Predefined complex operations

## Key Functions

### Drawing Pipeline
```javascript
paint() → drawGrid/drawCircle/drawRowCol() → renderLayers()
```

### Text Generation Pipeline
```javascript
textGetter() → nextText() → paintActions() → renderLayers()
```

### Transform Operations
- **Rotation**: Canvas and text rotation with cumulative options
- **Mirroring**: Horizontal/vertical canvas flipping
- **Shifting**: Pixel-level canvas translation

## State Management

### Parameters
- Global application parameters (`allParams`)
- Fill and outline color parameters
- Drawing mode and text behavior settings
- Canvas size and rendering options

### Recording System
- Action recording for playback scripts
- Configuration state tracking
- Export capabilities for automation

## Performance Considerations

- **Generator functions**: Memory-efficient text/coordinate generation
- **Layer separation**: Isolated drawing operations
- **Pixel density management**: Optimized for different display types
- **Frame rate control**: Adjustable for smooth interaction vs. capture modes

## Integration Points

### GUI Integration
- QuickSettings-based control panels
- Real-time parameter binding
- Preset save/load system

### File Operations
- Canvas export (PNG format)
- Animation frame capture
- Settings persistence (localStorage)

## Current Limitations & TODOs

Based on comments in the code:
- Undo system doesn't track rotation operations
- Canvas rotation works best with square canvases
- Some color modes need refinement
- Target mode is incomplete
- Performance could be optimized for large canvases

## Questions for Further Documentation

1. Would you like me to detail any specific subsystem (color management, layer system, etc.)?
2. Are there particular pain points or areas you'd like better documented?
3. Should I focus on the user-facing features or the internal architecture for future documentation?

This overview provides the foundation for more detailed documentation of specific components. The codebase shows a mature creative coding application with sophisticated text-as-brush painting capabilities.

---

_**User**_

Can you repeat this information, but format the entire thing in markdown?

---

_**Assistant**_

# Sketch.js - Core Application Overview

## Purpose
The main sketch file implements a multi-layered text painting application using p5.js. It transforms text into visual art through various drawing modes, color schemes, and interactive controls.

## Architecture Overview

### Core Components
- **Layer Management**: Multi-canvas system with drawing layer, main canvas, and temporary layers
- **Drawing Modes**: Three primary modes - Grid, Circle, and RowCol text layouts
- **Color Systems**: HSB color mode with multiple paint algorithms (rainbow, lerp, solid, etc.)
- **Text Management**: Handles font loading, text rendering, and character/word generation
- **Undo System**: History management for canvas states

### Key Modules Integration
```javascript
// Core dependencies
import UndoLayers from './undo.layers.js'
import Layers from './layers.js'
import { setupGui } from '@/src/gui/gui'
import { setupActions } from '@/src/gui/actions'
```

## Application Modes

### Drawing Modes
1. **STANDARD_DRAW**: Normal interactive painting mode
2. **NO_DRAW**: Paused state, no drawing operations
3. **PLAYBACK**: Script replay mode for automation
4. **TARGET**: Canvas point selection mode (incomplete feature)

### Paint Modes
- **Grid**: Text arranged in grid patterns with configurable spacing
- **Circle**: Text arranged along circular/arc paths
- **RowCol**: Simple row/column text layout

## Core Functionality

### Canvas Management
- **Multi-layer system**: Main display canvas + drawing layer + temporary layer
- **Dynamic resizing**: Canvas dimensions adjustable at runtime
- **Pixel density**: Retina/high-DPI display support

### Text Rendering
- **Font loading**: TTF fonts loaded from assets
- **Text sizing**: Automatic fitting algorithms for different contexts
- **Character modes**: Sequential, random, or word-based text generation

### Color Systems
Multiple paint modes available:
- `rainbow1-4`: HSB-based positional coloring
- `lerp-quad/scheme`: Multi-color interpolation
- `gray1-2`: Grayscale gradients
- `solid`: Single color fills

### Interactive Features
- **Mouse painting**: Click and drag to paint text
- **Keyboard shortcuts**: Extensive hotkey system
- **Auto-paint mode**: Automated random painting
- **Macro system**: Predefined complex operations

## Key Functions

### Drawing Pipeline
```javascript
paint() → drawGrid/drawCircle/drawRowCol() → renderLayers()
```

### Text Generation Pipeline
```javascript
textGetter() → nextText() → paintActions() → renderLayers()
```

### Transform Operations
- **Rotation**: Canvas and text rotation with cumulative options
- **Mirroring**: Horizontal/vertical canvas flipping
- **Shifting**: Pixel-level 

---

